module.exports=function(t){var i={};function s(e){if(i[e])return i[e].exports;var r=i[e]={i:e,l:!1,exports:{}};return t[e].call(r.exports,r,r.exports,s),r.l=!0,r.exports}return s.m=t,s.c=i,s.d=function(t,i,e){s.o(t,i)||Object.defineProperty(t,i,{enumerable:!0,get:e})},s.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},s.t=function(t,i){if(1&i&&(t=s(t)),8&i)return t;if(4&i&&"object"==typeof t&&t&&t.__esModule)return t;var e=Object.create(null);if(s.r(e),Object.defineProperty(e,"default",{enumerable:!0,value:t}),2&i&&"string"!=typeof t)for(var r in t)s.d(e,r,function(i){return t[i]}.bind(null,r));return e},s.n=function(t){var i=t&&t.__esModule?function(){return t.default}:function(){return t};return s.d(i,"a",i),i},s.o=function(t,i){return Object.prototype.hasOwnProperty.call(t,i)},s.p="",s(s.s=1)}([function(t,i){t.exports={sTR:(t,i,s)=>{io.in(t).emit(i,s)},sTA:(t,i)=>{io.emit(t,i)}}},function(t,i,s){(function(i){const e=s(3);class r{constructor(){this.q={},this.f=[]}fire(t,i){const s=this.q[t];if(void 0!==s){for(let t=0,e=s.length;t<e;t++)s[t](i);this.f[t]=!0}}on(t,i){if(!0===this.f[t])return i();void 0===this.q[t]&&(this.q[t]=[]),this.q[t].push(i)}}let h;i.E=new r,t.exports={io:t=>{h||(E=new r,E.on("E",()=>{Object.values(io.of("/").connected).forEach(t=>{t.disconnect(!0),t=null}),h=null}),h=e()),t.on("pj",(i,s,e)=>h.join({name:rsc(i),id:s,socket:t,coil:e}))},checkPlayerId:(t,i)=>{const{playerId:s}=t.body;i.send(h.hP(s))}}}).call(this,s(2))},function(t,i){var s;s=function(){return this}();try{s=s||new Function("return this")()}catch(t){"object"==typeof window&&(s=window)}t.exports=s},function(t,i,s){const e=s(4),{sTA:r}=s(0);t.exports=function(){let t,i="w",s=e(),h=5e3,l={red:100,green:100,blue:100};E.on("TP",e=>{l[e]+=100,l[e]>h?(i="f",clearInterval(t),r("ge",e),s=null,E.fire("E")):(o(),E.fire("U",e))});const o=t=>{const i=Object.entries(l).reduce((t,[i,s])=>({...t,[i]:100/h*s}),{});t?t.emit("tu",i):r("tu",i)},n=()=>{i="a",t=setInterval(f,1e3),r("gs")},f=()=>s.cy();return{hP:t=>s.hP(t),getState:()=>i,gPL:()=>s.gPL(),start:n,join:({id:t,name:e,socket:r,coil:l})=>{s.hP(t)?s.reP(t,r):s.aP(t,e,r,l),h=5e3*Math.ceil(s.gPL().length/3),o(r),"w"===i&&s.gPL().length>=3?n():"a"===i&&r.emit("gs")}}}},function(t,i,s){const{sTA:e}=s(0),r=s(5),h=s(7);t.exports=()=>{let t={},i=h();i.at("red"),i.at("green"),i.at("blue"),E.on("TU",()=>e("ut",i.gts())),E.on("PS",({id:i,subscriberId:s})=>{const e=l(i);e.iS(s),t[s].sub=e,E.fire("TU")});const s=t=>{t.active=!1,E.fire("PL",t)},l=i=>Object.values(t).find(t=>t.id.substr(0,8)===i);return{aP:(e,h,l,o)=>{const n=i.gwt(),f=new r({id:e,name:h,socket:l,ti:n.id,coil:o});t[e]=f,l.on("disconnect",()=>s(f)),l.join(f.ti),n.aM(f)},gPL:()=>Object.values(t).map(t=>t.gps()),hP:i=>t.hasOwnProperty(i),reP:(i,s)=>{const e=t[i];e.re(s),s.join(e.ti),e.sfc(),E.fire("PR",e)},cy:()=>Object.values(t).forEach(t=>t.cy())}}},function(t,i,s){const e=s(6),{sTR:r}=s(0);class h{constructor(t){this.player=t,this.socket=t.socket,this.i()}i(){this.socket.on("fb",t=>this.player.bf(t)),this.socket.on("fl",t=>{this.player.sub?this.player.sub.lf(t,!1):this.player.lf(t)}),this.socket.on("tp",()=>this.player.pt()),this.socket.on("ps",t=>this.player.sTP(t)),this.socket.on("pu",()=>this.player.us()),this.socket.on("fd",t=>this.player.df(t)),this.socket.on("fa",(t,i)=>this.player.af(t,i)),this.socket.on("rs",t=>{this.player.id===t&&this.player.rs()})}fire(t,i){"FU"===t?(this.player.sub||this.socket.emit("fu",i),r(this.player.id.substr(0,8),"fu",i)):this.socket.emit("su",i)}}t.exports=class{constructor({id:t,name:i,socket:s,ti:r,coil:l=!1}){this.id=t,this.name=i,this.socket=s,this.level=1,this.active=!0,this.ti=r,this.fields=new e({id:t}),this.e=new h(this),this.p=0,this.gF(),this.gold=l?parseInt(600):500,this.food=l?parseInt(144):120,this.iron=0,this.villagers=5,this.soldiers=0,this.fpr=300,this.vl=8,this.pdt=0,this.gp=0,this.fc=0,this.fp=0,this.ip=0,this.e.fire("SU",this.gs())}re(t){this.socket=t,this.active=!0,this.e=new h(this),this.sub=!1}gps(t=!0){const{id:i,name:s,level:e,active:r,ti:h}=this;return{id:t?i.substr(0,8):i,name:s,level:e,active:r,ti:h}}gs(){const{gold:t,food:i,iron:s,villagers:e,soldiers:r,fpr:h,vl:l,fp:o,fc:n,ip:f,gp:c}=this;return{gold:t,food:i,iron:s,villagers:e,soldiers:r,fpr:h,vl:l,fp:o,fc:n,ip:f,gp:c}}gF(){const t=this.fields.cif();this.socket.emit("if",{team:this.ti,...t})}sfc(){E.fire("U",this.ti),this.socket.emit("if",{team:this.ti,...this.fields.gfc()})}bf(t){this.gold>=this.fpr&&(this.gold-=this.fpr,this.fpr+=Math.floor(.25*this.fpr),this.uv(),this.e.fire("SU",this.gs()),this.e.fire("FU",this.fields.bf(t)),E.fire("U",this.ti))}lf(t,i=!0){const s=this.fields.lf(t,i?1:-1);this.uv(),this.e.fire("SU",this.gs()),this.e.fire("FU",s),E.fire("U",this.ti)}pt(){this.gold>=100&&(this.gold-=100,this.pdt+=100,E.fire("TP",this.ti),this.e.fire("SU",this.gs()))}rs(){this.gold>=100&&this.iron>=100&&(this.soldiers++,this.gold-=100,this.iron-=100,this.e.fire("SU",this.gs()))}cy(){const t=this.level;this.uv(),this.p>5?(this.p=0,this.cR()):this.p++,this.e.fire("SU",this.gs()),t!==this.level&&E.fire("U",this.ti)}uv(){this.level=this.fields.dpl(),this.vl=this.fields.dvl(),this.gp=3*this.villagers,this.fc=2*this.villagers,this.fp=Math.floor(this.fields.dh()),this.ip=Math.floor(this.fields.di())}cR(){const t=this.fields.gft("village").length;this.food+=this.fp-this.fc,this.food<0?(this.food=0,this.villagers>=t&&(this.villagers-=t)):this.villagers<=this.vl-t?this.villagers+=t:this.villagers<this.vl&&this.villagers++,this.gold+=this.gp,this.iron+=this.ip}sTP(t){this.sub=!1,this.socket.join(t),E.fire("PS",{id:t,subscriberId:this.id})}us(){this.sub&&(this.socket.leave(this.sub.id.substr(0,8)),this.sub=!1,this.sfc())}iS(){r(this.id.substr(0,8),"if",{team:this.ti,...this.fields.gfc(),self:!1})}df(t){const i=this.fields.gf(t);i&&i.att>0&&this.soldiers>0&&(i.att--,this.soldiers--,this.e.fire("FU",i.gs()),this.e.fire("SU",this.gs()))}af(t,i){this.soldiers>i&&this.soldiers>0&&this.sub&&this.sub.ti!==this.ti&&(this.soldiers-=i>0?i:1,this.sub.ra(t),this.e.fire("SU",this.gs()))}ra(t){const i=this.fields.gf(t);i.att++,this.e.fire("FU",i.gs()),this.e.fire("SU",this.gs())}}},function(t,i){const s=["village","farm","mine","village","farm","mine","village","farm","plain","plain","plain","plain"];class e{constructor({id:t,type:i}){this.id=t,this.type=i,this.level=fV(i)>2?1:0,this.ths=12,this.att=0}gs(){const{id:t,type:i,level:s,ths:e,att:r}=this;return{id:t,type:i,level:s,ths:e,att:r}}gt(){const t=Math.floor(Math.random()*s.length);this.type=s[t]||"plain",s[t]="plain",this.level="plain"===this.type?0:1}}t.exports=class{constructor({id:t}){this.id=t,this.fO={},this.fAr=[]}cif(){const t=[["blocked","blocked","blocked","village","empty","empty"],["blocked","blocked","plain","plain","farm","empty"],["empty","empty","mine","empty","empty","empty"],["blocked","empty","empty","empty","empty","empty"],["blocked","empty","empty","empty","empty","blocked"]];this.fAr=t;for(let i=0;i<t.length;i++)for(let s=0;s<t[i].length;s++){const t=this.fAr[i][s];if(fV(t)>0){const r=gId();this.fO[r]=new e({id:r,type:t}),this.fAr[i][s]=r}}return this.gfc()}gfc(){return{fAr:this.fAr,fO:Object.entries(this.fO).reduce((t,[i,s])=>({...t,[i]:s.gs()}),{})}}gf(t){return this.fO[t]}bf(t){const i=this.gf(t);return i.gt(),i.gs()}lf(t,i){const s=this.gf(t);if(s)return s.level+=i,0===s.level&&(s.level=1),s.ths=10+s.level*s.level,s.gs();console.log("No Field! "+t)}gft(t){return Object.values(this.fO).filter(i=>i.type===t&&!i.att)}dpl(){return Object.values(this.fO).reduce((t,{level:i})=>t+i,-2)}dh(){return this.gft("farm").reduce((t,{level:i})=>t+15+3*i,0)}dvl(){return this.gft("village").reduce((t,{level:i})=>t+8+2*i,0)}di(){return this.gft("mine").reduce((t,{level:i})=>t+5+1*i,0)}}},function(t,i,s){const e=s(8);t.exports=()=>{const t={};E.on("PL",i=>t[i.ti].update()),E.on("PR",i=>t[i.ti].update()),E.on("U",i=>t[i].update());return{at:i=>t[i]=new e(i),gt:i=>t[i],gwt:()=>Object.values(t).sort((t,i)=>t.members.length-i.members.length)[0],gts:()=>Object.entries(t).reduce((t,[i,s])=>({...t,[i]:s.gts()}),{})}}},function(t,i){t.exports=class{constructor(t){this.members=[],this.id=t}aM(t){this.im(t.id)||(this.members.push(t),this.update())}im(t){return this.members.some(({id:i})=>t===i)}update(){this.members.sort((t,i)=>{const s=this.gm(t.id),e=this.gm(i.id);if(!(e&&s&&s.active))return 1;if(!e.active)return-1;const r=e.level-s.level;return 0!==r?r:e.pdt-s.pdt}),E.fire("TU")}gm(t){return this.members.find(({id:i})=>t===i)}gts(){return this.members.map(t=>t.gps())}}}]);