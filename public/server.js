module.exports=function(t){var s={};function i(e){if(s[e])return s[e].exports;var r=s[e]={i:e,l:!1,exports:{}};return t[e].call(r.exports,r,r.exports,i),r.l=!0,r.exports}return i.m=t,i.c=s,i.d=function(t,s,e){i.o(t,s)||Object.defineProperty(t,s,{enumerable:!0,get:e})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,s){if(1&s&&(t=i(t)),8&s)return t;if(4&s&&"object"==typeof t&&t&&t.__esModule)return t;var e=Object.create(null);if(i.r(e),Object.defineProperty(e,"default",{enumerable:!0,value:t}),2&s&&"string"!=typeof t)for(var r in t)i.d(e,r,function(s){return t[s]}.bind(null,r));return e},i.n=function(t){var s=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(s,"a",s),s},i.o=function(t,s){return Object.prototype.hasOwnProperty.call(t,s)},i.p="",i(i.s=1)}([function(t,s){t.exports={sTR:(t,s,i)=>{io.in(t).emit(s,i)},sTA:(t,s)=>{io.emit(t,s)}}},function(t,s,i){(function(s){const e=i(3);class r{constructor(){this.q={},this.f=[]}fire(t,s){const i=this.q[t];if(void 0!==i){for(let t=0,e=i.length;t<e;t++)i[t](s);this.f[t]=!0}}on(t,s){if(!0===this.f[t])return s();void 0===this.q[t]&&(this.q[t]=[]),this.q[t].push(s)}}let h;s.E=new r,t.exports={io:t=>{h||(E=new r,E.on("E",()=>{Object.values(io.of("/").connected).forEach(t=>{t.disconnect(!0),t=null}),h=null}),h=e()),t.on("pj",(s,i,e)=>h.join({name:rsc(s),id:i,socket:t,coil:e}))},checkPlayerId:(t,s)=>{const{playerId:i}=t.body;s.send(h.hP(i))}}}).call(this,i(2))},function(t,s){var i;i=function(){return this}();try{i=i||new Function("return this")()}catch(t){"object"==typeof window&&(i=window)}t.exports=i},function(t,s,i){const e=i(4),{sTA:r}=i(0);t.exports=function(){let t,s="w",i=e(),h={red:0,green:0,blue:0};E.on("TP",e=>{h[e]+=100,h[e]>6e3?(s="f",clearInterval(t),r("ge",e),i=null,E.fire("E")):(o(),E.fire("U",e))});const o=t=>{const s=Object.entries(h).reduce((t,[s,i])=>({...t,[s]:100/6e3*i}),{});t?t.emit("tu",s):r("tu",s)},l=()=>{s="a",t=setInterval(n,1e3),r("gs")},n=()=>i.cy();return{hP:t=>i.hP(t),getState:()=>s,gPL:()=>i.gPL(),start:l,join:({id:t,name:e,socket:r,coil:h})=>{i.hP(t)?i.reP(t,r):i.aP(t,e,r,h),o(r),"w"===s&&i.gPL().length>=3?l():"a"===s&&r.emit("gs")}}}},function(t,s,i){const{sTA:e}=i(0),r=i(5),h=i(7);t.exports=()=>{let t={},s=h();s.at("red"),s.at("green"),s.at("blue"),E.on("TU",()=>e("ut",s.gts())),E.on("PS",({id:s,subscriberId:i})=>{const e=o(s);e.iS(i),t[i].sub=e,E.fire("TU")});const i=t=>{t.active=!1,E.fire("PL",t)},o=s=>Object.values(t).find(t=>t.id.substr(0,8)===s);return{aP:(e,h,o,l)=>{const n=s.gwt(),f=new r({id:e,name:h,socket:o,ti:n.id,coil:l});t[e]=f,o.on("disconnect",()=>i(f)),o.join(f.ti),n.aM(f)},gPL:()=>Object.values(t).map(t=>t.gps()),hP:s=>t.hasOwnProperty(s),reP:(s,i)=>{const e=t[s];e.re(i),i.join(e.ti),e.sfc(),E.fire("PR",e)},cy:()=>Object.values(t).forEach(t=>t.cy())}}},function(t,s,i){const e=i(6),{sTR:r}=i(0);class h{constructor(t){this.player=t,this.socket=t.socket,this.i()}i(){this.socket.on("fb",t=>this.player.bf(t)),this.socket.on("fl",t=>{this.player.sub?this.player.sub.lf(t,!1):this.player.lf(t)}),this.socket.on("tp",()=>this.player.pt()),this.socket.on("ps",t=>this.player.sTP(t)),this.socket.on("pu",()=>this.player.us()),this.socket.on("fd",t=>this.player.df(t)),this.socket.on("fa",(t,s)=>this.player.af(t,s)),this.socket.on("rs",t=>{this.player.id===t&&this.player.rs()})}fire(t,s){"FU"===t?(this.player.sub||this.socket.emit("fu",s),r(this.player.id.substr(0,8),"fu",s)):this.socket.emit("su",s)}}t.exports=class{constructor({id:t,name:s,socket:i,ti:r,coil:o=!1}){this.id=t,this.name=s,this.socket=i,this.level=1,this.active=!0,this.ti=r,this.fields=new e({id:t}),this.e=new h(this),this.p=0,this.gF(),this.gold=o?parseInt(600):500,this.food=o?parseInt(144):120,this.iron=0,this.villagers=5,this.soldiers=0,this.fpr=300,this.vl=8,this.pdt=0,this.gp=0,this.fc=0,this.fp=0,this.ip=0,this.e.fire("SU",this.gs())}re(t){this.socket=t,this.active=!0,this.e=new h(this),this.sub=!1}gps(t=!0){const{id:s,name:i,level:e,active:r,ti:h,pdt:o}=this;return{id:t?s.substr(0,8):s,name:i,level:e,active:r,ti:h,pdt:o}}gs(){const{gold:t,food:s,iron:i,villagers:e,soldiers:r,fpr:h,vl:o,fp:l,fc:n,ip:f,gp:c}=this;return{gold:t,food:s,iron:i,villagers:e,soldiers:r,fpr:h,vl:o,fp:l,fc:n,ip:f,gp:c}}gF(){const t=this.fields.cif();this.socket.emit("if",{team:this.ti,...t})}sfc(){E.fire("U",this.ti),this.socket.emit("if",{team:this.ti,...this.fields.gfc()})}bf(t){this.gold>=this.fpr&&(this.gold-=this.fpr,this.fpr+=Math.floor(.25*this.fpr),this.uv(),this.e.fire("SU",this.gs()),this.e.fire("FU",this.fields.bf(t)),E.fire("U",this.ti))}lf(t,s=!0){const i=this.fields.lf(t,s?1:-1);this.uv(),this.e.fire("SU",this.gs()),this.e.fire("FU",i),E.fire("U",this.ti)}pt(){this.gold>=100&&(this.gold-=100,this.pdt+=100,E.fire("TP",this.ti),this.e.fire("SU",this.gs()))}rs(){this.gold>=100&&this.iron>=100&&(this.soldiers++,this.gold-=100,this.iron-=100,this.e.fire("SU",this.gs()))}cy(){const t=this.level;this.uv(),this.p>5?(this.p=0,this.cR()):this.p++,this.e.fire("SU",this.gs()),t!==this.level&&E.fire("U",this.ti)}uv(){this.level=this.fields.dpl(),this.vl=this.fields.dvl(),this.gp=3*this.villagers,this.fc=2*this.villagers,this.fp=Math.floor(this.fields.dh()),this.ip=Math.floor(this.fields.di())}cR(){const t=this.fields.gft("village").length;this.food+=this.fp-this.fc,this.food<0?(this.food=0,this.villagers>=t&&(this.villagers-=t)):this.villagers<=this.vl-t?this.villagers+=t:this.villagers<this.vl&&this.villagers++,this.gold+=this.gp,this.iron+=this.ip}sTP(t){this.sub=!1,this.socket.join(t),E.fire("PS",{id:t,subscriberId:this.id})}us(){this.sub&&(this.socket.leave(this.sub.id.substr(0,8)),this.sub=!1,this.sfc())}iS(){r(this.id.substr(0,8),"if",{team:this.ti,...this.fields.gfc(),self:!1})}df(t){const s=this.fields.gf(t);s&&s.att>0&&this.soldiers>0&&(s.att--,this.soldiers--,this.e.fire("FU",s.gs()),this.e.fire("SU",this.gs()))}af(t,s){this.soldiers>s&&this.soldiers>0&&this.sub&&this.sub.ti!==this.ti&&(this.soldiers-=s>0?s:1,this.sub.ra(t),this.e.fire("SU",this.gs()))}ra(t){const s=this.fields.gf(t);s.att++,this.e.fire("FU",s.gs()),this.e.fire("SU",this.gs())}}},function(t,s){const i=["village","farm","mine","village","farm","mine","village","farm","plain","plain","plain","plain"];class e{constructor({id:t,type:s}){this.id=t,this.type=s,this.level=fV(s)>2?1:0,this.ths=12,this.att=0}gs(){const{id:t,type:s,level:i,ths:e,att:r}=this;return{id:t,type:s,level:i,ths:e,att:r}}gt(){const t=Math.floor(Math.random()*i.length);this.type=i[t]||"plain",i[t]="plain",this.level="plain"===this.type?0:1}}t.exports=class{constructor({id:t}){this.id=t,this.fO={},this.fAr=[]}cif(){const t=[["blocked","blocked","blocked","village","empty","empty"],["blocked","blocked","plain","plain","farm","empty"],["empty","empty","mine","empty","empty","empty"],["blocked","empty","empty","empty","empty","empty"],["blocked","empty","empty","empty","empty","blocked"]];this.fAr=t;for(let s=0;s<t.length;s++)for(let i=0;i<t[s].length;i++){const t=this.fAr[s][i];if(fV(t)>0){const r=gId();this.fO[r]=new e({id:r,type:t}),this.fAr[s][i]=r}}return this.gfc()}gfc(){return{fAr:this.fAr,fO:Object.entries(this.fO).reduce((t,[s,i])=>({...t,[s]:i.gs()}),{})}}gf(t){return this.fO[t]}bf(t){const s=this.gf(t);return s.gt(),s.gs()}lf(t,s){const i=this.gf(t);if(i)return i.level+=s,0===i.level&&(i.level=1),i.ths=10+i.level*i.level,i.gs();console.log("No Field! "+t)}gft(t){return Object.values(this.fO).filter(s=>s.type===t&&!s.att)}dpl(){return Object.values(this.fO).reduce((t,{level:s})=>t+s,-2)}dh(){return this.gft("farm").reduce((t,{level:s})=>t+15+3*s,0)}dvl(){return this.gft("village").reduce((t,{level:s})=>t+8+2*s,0)}di(){return this.gft("mine").reduce((t,{level:s})=>t+5+1*s,0)}}},function(t,s,i){const e=i(8);t.exports=()=>{const t={};E.on("PL",s=>t[s.ti].update()),E.on("PR",s=>t[s.ti].update()),E.on("U",s=>t[s].update());return{at:s=>t[s]=new e(s),gt:s=>t[s],gwt:()=>Object.values(t).sort((t,s)=>t.members.length-s.members.length)[0],gts:()=>Object.entries(t).reduce((t,[s,i])=>({...t,[s]:i.gts()}),{})}}},function(t,s){t.exports=class{constructor(t){this.members=[],this.id=t}aM(t){this.im(t.id)||(this.members.push(t),this.update())}im(t){return this.members.some(({id:s})=>t===s)}update(){E.fire("TU")}gm(t){return this.members.find(({id:s})=>t===s)}gts(){return this.members.map(t=>t.gps())}}}]);